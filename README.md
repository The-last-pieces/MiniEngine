# Mini-Engine

一个迷你的软渲染器 , 后续可能加入物理引擎功能 .

基于C++20开发 , CMake构建 . 核心内容不依赖外部库 .

实现了 矩阵&向量运算及其工厂函数 , 模型&纹理读取 , 透视投影 , 反锯齿 , Shader接口 , 光线阴影 等功能.

还通过GLFW的UI相关库(不涉及核心渲染过程) , 将渲染结果和平均帧率实时显示在可视化界面中 .

# 运行效果

![](res/markdown/demo2.png)

# 成像方法

## 光栅化

光栅化成像方法是实时渲染中广泛应用的一种技术 , 流程如下 .

- 输入图元
- 执行顶点着色器 , 对图元进行坐标变换
    - 模型变换 : 局部坐标 => 世界坐标
    - 视图变换 : 世界坐标 => 观察坐标
    - 剪切变换 : 观察坐标 => 裁剪坐标
- 对与-1,1有交点的图元进行裁剪形成新的图元
- 对每个图元进行光栅化转换为片元
- 插值获取片元信息 , 并执行片元着色器
- 屏幕变换 : 裁剪坐标 => 屏幕坐标
- 呈现图片

## 光线追踪

光线追踪的成像方法质量更高 , 开销也会更大 , 本项目后期会做实现 .

- 摄像机为视口上每个像素发射感受光
- 使用高效筛选图元的方法(如包围盒,八叉树)寻找可能碰撞的图元
- 求解碰撞点,并确认是否位于图元上
- 判断碰撞点是否可被光源照射,并统计可见点信息
- 根据碰撞点的材质计算反射和折射光,递归执行
- 将所有可见点信息根据某种光照模型作为最终像素信息
- 显示图像

# 着色器

顶点着色器 :

- gl_Position - in-out  
  顶点坐标
- gl_TexCoord - in  
  纹理坐标
- gl_Color - out  
  点的颜色

片元着色器 :

- gl_FragCoord - in  
  片元坐标
- gl_TexCoord - in  
  纹理坐标
- gl_FragColor - out  
  片元颜色
- gl_Discard - out  
  是否丢弃片元,如果丢弃则使用顶点着色器的信息进行插值

# 模块划分

```
- engine              // 引擎相关
  - math              // 数学相关
    - vec.hpp         // 提供向量(也可视为点)运算
    - utils.hpp       // 提供常用的数学相关函数
    - mat.hpp         // 提供矩阵运算
  - data              // 数据相关,渲染中用到的杂项类
    - camera.hpp      // 管理摄像机属性
    - color.hpp       // 提供颜色运算
  - store             // 存储相关,需要导入导出的资源文件
    - model.hpp       // 储存顶点,图元数据,可从文件加载
    - image.hpp       // 储存BMP图片
    - texture.hpp     // 储存纹理文件
  - interface         // 接口相关
    - shader.hpp      // 着色器,包括顶点着色器和片段着色器
    - render.hpp      // 渲染器,输入摄像机+光源+模型信息,输出图片
  - physical          // 物理相关
    - collision.hpp   // 碰撞检测算法
  - render            // 渲染相关
    - rt_render.hpp   // 光线追踪(Ray Tracing)渲染器,使用Path Tracing算法
    - rs_render.hpp   // 光栅化(Rasterization)渲染器
- view                // 显示+控制层
  - gui.hpp           // 维护摄像机位置,实时渲染引擎输出并显示帧率
- main.cpp            // 入口文件,负责程序参数的解析
```